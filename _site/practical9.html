<h1 id="objectives">Objectives</h1>
<p>The learning objectives for this practical are:</p>
<ul>
<li>Writing R scripts</li>
</ul>
<h1 id="setup-and-background">Setup and background</h1>
<p>To do this practical you need an installation of R and RStudio. You can find the instructions in the <a href="/setup/">setup</a> link on how to install R and RStudio in your system. For a smooth development of this practical, it is strongly recommended that you follow and finish the previous <a href="/practical%208/">practical 8</a>.</p>
<p>We will download some COVID19 data to illustrate the use of R and RStudio. Please follow the next two steps:</p>
<ol style="list-style-type: decimal">
<li>Go to the Catalan Health Departament COVID19 data portal at <a href="https://dadescovid.cat" class="uri">https://dadescovid.cat</a> and switch the language to &quot;ENGLISH&quot; using the pull-down menu on the top-right corner of the page.</li>
<li>Follow the downloads link and on the next page click and download the file corresponding to the &quot;7 DAY AGGREGATION&quot; for &quot;CATALUNYA&quot;. Make sure you know exactly where in your filesystem this file has been downloaded. <strong>Tip:</strong> some browsers automatically download files into a folder called &quot;Downloads&quot; or under a name corresponding to the translation of &quot;Downloads&quot; to the default language of your operating system.</li>
<li>Make a directory in your filesystem, for instance at your <em>home</em> directory, called <code>practical9</code> and copy in it the downloaded file.</li>
<li>Since the downloaded file is a ZIP file, uncompress as you did in <a href="/practical1/">practical 1</a> so that you finally have a file called <code>catalunya_setmanal.csv</code> in the directory <code>practical8</code>.</li>
</ol>
<p>If you are using the UPF <em>myapps</em> cloud to run RStudio, then you need to either use an internet browser in <em>myapps</em> to download the data file directly in the <em>myapps</em> cloud or upload to the <em>myapps</em> cloud the file that you have downloaded in your own computer.</p>
<h1 id="writing-r-scripts">Writing R scripts</h1>
<p>We may often use an interactive R session to quickly examine data or make some straightforward calculations. In such an interactive session, we can also recover previous instructions in the R shell by pressing the <code>upwards arrow</code> key. However, if we really want to keep track of the R commands we are using, we should write them in a text file with filename extension <code>.R</code>, which we shall refer hereafter as an <em>R script</em>.</p>
<p>There are two main ways to create an R script: (1) openining a new file with a text editor and saving it with filename that includes the <code>.R</code> extension, or (2) if we are working with RStudio, then we click on the <code>File</code> menu and select the options <code>New File</code> -&gt; <code>R Script</code>. When we do that we should be getting the RStudio window splitted in four panes, the default three ones and one additional one for the newly created R script, as shown in the captured window below.</p>
<div class="figure">
<img src="RStudioNewScript.png" />

</div>
<p>Type in the newly created R script (either with a text editor or with RStudio) the following two lines to read the CSV file downloaded in the previous section. The first line is a comment. Lines starting with the <code>#</code> symbol are comments in R.</p>
<pre><code>## read COVID19 data
dat &lt;- read.csv(&quot;catalunya_setmanal.csv&quot;)</code></pre>
<p>Now save the R script in the directory <code>practical9</code> under the filename <code>covid19analysis.R</code>.</p>
<p>To execute a specific line of an R script in RStudio you should move the cursor to that line in the pane with the script file and press the key combination <code>Ctrl+Enter</code>. Alternatively, you can also copy and paste the line from the script to the R shell, specially if you are not working with RStudio.</p>
<p>The previous line may produce an error if the current working directory of R is not pointing to the directory where the file <code>catalunya_setmanal.csv</code> is; see previous <a href="/practical8/">practical 8</a> if you need to find out how to change the working directory in R and RStudio. In general, changing the working directory should be always performed in the R shell and never include the instruction that changes the working directory in an R script. The reason is because you or somebody else may want to run that script in a different computer where the directory with the data may be called differently.</p>
<p>Add to the script <code>covid19analysis.R</code> the necessary code to obtain a new <code>data.frame</code> object including only data from the general population, i.e., excluding data from geriatric residences.</p>
<h1 id="date-data-management">Date-data management</h1>
<p>These are the first 6 rows of the previously loaded CSV file:</p>
<pre><code>&gt; head(dat)
        NOM      CODI   DATA_INI    DATA_FI RESIDENCIA IEPG_CONFIRMAT
1 CATALUNYA CATALUNYA 2020-11-01 2020-11-07         --             NA
2 CATALUNYA CATALUNYA 2020-11-01 2020-11-07         Si             NA
3 CATALUNYA CATALUNYA 2020-11-01 2020-11-07         No        611.099
4 CATALUNYA CATALUNYA 2020-10-31 2020-11-06         --             NA
5 CATALUNYA CATALUNYA 2020-10-31 2020-11-06         Si             NA
6 CATALUNYA CATALUNYA 2020-10-31 2020-11-06         No        641.672
  R0_CONFIRMAT_M      IA14 TAXA_CASOS_CONFIRMAT CASOS_CONFIRMAT TAXA_PCR_TAR
1             NA    0.0000               0.0000             529        0.000
2             NA 2798.2745            1396.7672             884    16680.624
3       0.880132  694.3272             306.0293           23372     3137.612
4             NA    0.0000               0.0000             546        0.000
5             NA 2844.0961            1439.4286             911    17522.792
6       0.906287  708.0233             317.5911           24255     3213.137
     PCR   TAR PERC_PCR_TAR_POSITIVES INGRESSOS_TOTAL INGRESSOS_CRITIC EXITUS
1   3582   166                 7.3237              68               15      0
2   8469  2088                10.4550             114                5    139
3 178471 61154                10.7314            1512              295    312
4   3890   164                 7.0030              71               14      0
5   8937  2153                10.1535             114                6    153
6 184715 60678                10.8609            1578              279    315</code></pre>
<p>It has two columns with date information (<code>DATA_INI</code> and <code>DATA_FI</code>), but which are stored as string characters (more specifically <em>factors</em>). However, R provides a way to store dates as such and this has the advantage that facilitates manipulating them for analysis purposes.</p>
<p>For instance, to two transform the two columns containing date data we should use the function <code>as.Date()</code> as follows:</p>
<pre><code>&gt; startdate &lt;- as.Date(dat$DATA_INI)
&gt; enddate &lt;- as.Date(dat$DATA_FI)</code></pre>
<p>While R displays these objects as vectors of character strings, they do belong to a different class of objects, the class <em>Date</em>.</p>
<pre><code>&gt; head(startdate)
[1] &quot;2020-11-01&quot; &quot;2020-11-01&quot; &quot;2020-11-01&quot; &quot;2020-10-31&quot; &quot;2020-10-31&quot; &quot;2020-10-31&quot;
&gt; class(startdate)
[1] &quot;Date&quot;
&gt; head(enddate)
[1] &quot;2020-11-07&quot; &quot;2020-11-07&quot; &quot;2020-11-07&quot; &quot;2020-11-06&quot; &quot;2020-11-06&quot; &quot;2020-11-06&quot;
&gt; class(enddate)
[1] &quot;Date&quot;</code></pre>
<p>Having dates stored as <code>Date</code>-class objects facilitates operations on dates such as calculating time differences:</p>
<pre><code>&gt; head(enddate - startdate + 1)
Time differences in days
[1] 7 7 7 7 7 7</code></pre>
<p>or extracting the month of each date:</p>
<pre><code>&gt; month &lt;- months.Date(startdate))
&gt; head(month)
[1] &quot;November&quot; &quot;November&quot; &quot;November&quot; &quot;October&quot;  &quot;October&quot;  &quot;October&quot; 
&gt; class(month)
[1] &quot;character&quot;</code></pre>
